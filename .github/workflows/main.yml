name: 编译 React Native iOS 应用

on:
  workflow_dispatch:  # 允许手动触发
  #push:
  #  branches: [ main ]  # 监听 main 分支推送
  #pull_request:
  #  branches: [ main ]  # 监听 PR 到 main 分支

jobs:
  build-ios:
    runs-on: macos-latest  # 必须使用 macOS 环境

    steps:
      - name: 拉取代码
        uses: actions/checkout@v4

      - name: 配置 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20.x  # 匹配项目的 Node 版本
          cache: 'yarn'       # 或 'npm'，根据项目包管理器选择

      - name: 安装前端依赖
        run: |
          yarn install --frozen-lockfile  # 或 npm install
          # 安装 pods 前先导航到 ios 目录
          cd ios
      - name: 清除 CocoaPods 缓存并安装依赖
        run: |
          cd ios
          pod cache clean --all  # 清除所有缓存
          rm -rf Podfile.lock Pods  # 清除本地依赖
          pod install --verbose  # 详细日志模式，便于排查

      #- name: 安装 CocoaPods 依赖 # 清除所有缓存
      #  run: |
      #    cd ios
      #    pod install  # 安装 iOS 原生依赖
     # 清除本地依赖
     # pod cache clean --all  
     #     rm -rf Podfile.lock Pods 
    # 详细日志模式，便于排查
      - name: 编译 Debug 版本（模拟器）
        run: |
          cd ios
          # 使用 xcodebuild 编译模拟器版本（无需证书）
          xcodebuild -workspace AwesomeProject.xcworkspace \
            -scheme AwesomeProject \
            -configuration Debug \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 15' \
            build
    